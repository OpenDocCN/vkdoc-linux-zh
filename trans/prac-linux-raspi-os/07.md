# 7.I/O 重定向和 Cron

在最后一章中，我们开始学习 Unix 类操作系统的 shell 脚本。我们现在对 shell 脚本已经很熟悉了。

继续这一势头，我们将在类 Unix 操作系统的 shell 中学习一些有用的特性。以下是我们将在本章学习的主题列表:

*   输入输出重定向

*   例行性工作排程

在这一章之后，我们将会很容易地在 shell 中使用上述高级特性。这是很短的一章。

## 输入输出重定向

在类 Unix 操作系统中，标准流是互连的输入和输出通道。三个标准互连通道是标准输入(stdin)、标准输出(stdout)和标准误差(stderr)。它们分别附加到文件句柄(或文件描述符)0、1 和 2。几乎所有的编程和脚本环境都有处理这些流的条款。让我们一个一个来看。

### 标准输入设备

这是标准输入。在大多数情况下，它是来自键盘的输入。让我们看一个例子。在当前位置创建一个名为 New.txt 的文件，并向该文件添加一些字符。我们知道可以用命令`cat`显示文件的内容，如下所示:

```
cat New.txt

```

我们可以使用 stdin 向`cat`命令提供数据，如下所示:

```
cat < New.txt

```

它将向我们显示命令中提到的文件内容。我们知道 Unix 将 0 与 stdin 相关联。因此，前面的命令也可以写成:

```
cat 0< New.txt

```

### 标准输出

标准输出通常是可视显示控制台(也可以是远程终端)。它由文件句柄 1 表示。假设我想把它重定向到一个文件。那么我可以写一个如下的命令:

```
ls -l 1> output.log

```

当我们执行前面的命令时，它不会在终端中显示输出。它会将输出重定向到命令中提到的文件。我们可以使用 cat 命令查看该文件的内容，如下所示:

```
cat output.log

```

我们也可以省略 1，将命令`ls -l 1> output.log`写成如下形式:

```
ls -l > output.log

```

如果文件已经存在，重定向操作符`>`会覆盖命令中提到的文件中以前的数据。我们可以使用`>>`重定向操作符添加到现有数据中，如下所示:

```
ls -l 1>> output.log
ls -l >> output.log

```

这两个命令执行相同的功能。

### 标准错误

我们可以重定向标准误差。它由文件句柄`2`表示。我们可以如下使用它:

```
ls -l 2>error.txt

```

它会将命令中的错误(如果有)重定向到命令中提到的文件。我们还可以重定向它并覆盖错误日志，如下所示:

```
ls -l 2>>error.txt

```

我们可以将输出和错误重定向到同一个文件，如下所示:

```
ls -l 1>output.txt 2>&1

```

我们也可以这样写:

```
ls -l >output.txt 2>&1

```

拒绝重定向到它的所有信息的设备文件是空设备。在类 Unix 操作系统中，是`/dev/null`。它也被称为 Unix 黑洞(非正式地)。我们通常将错误重定向到这个文件。它的用法如下:

```
ls -l 2>/dev/null

```

## 例行性工作排程

Cron 是类 Unix 操作系统中基于时间的调度程序。我们可以在固定的时间间隔运行程序或脚本。我们必须使用名为 **crontab** 的文件来设置 cron 作业。我们需要为要运行的预定作业创建条目。格式如下:

**(分钟)(小时)(月中某日)(月中某日)<要运行的程序或脚本>**

*   **分钟**可以有从 0 到 59 的值。

*   **小时**可以有从 0 到 23 的值。

*   **一个月中的某一天**可以有 1 到 31 之间的值。

*   **月**可以有从 1 到 12 的值。

*   **星期几**可以有从 0 到 6 的值。

让我们看几个例子。以下条目在每天午夜运行指定的脚本:

```
0 0 * * *  /home/pi/backup.sh

```

我们可以在每次重启时运行脚本或程序，如下所示:

```
@reboot /home/pi/test2.sh

```

我们可以每五分钟运行一个程序，如下所示:

```
*/1 * * * * /home/pi/test3.sh

```

我们可以使用以下命令来查看 crontab 中的当前条目:

```
crontab -l

```

我们可以使用以下命令来编辑 crontab 中的条目:

```
crontab -e

```

当你第一次运行它时，它会要求你选择编辑器。选择**纳米**编辑器。

让我们看一个简单的 shell 脚本和 crontab 用法的例子。让我们创建一个小 shell 脚本，如清单 [7-1](#PC18) 所示。

```
#!/bin/bash
logfile=reboot_hist.log
echo "System rebooted at : " >> $logfile
date >> $logfile

Listing 7-1reboot_hist.sh

```

使用以下命令更改其权限:

```
chmod 755 reboot_hist.sh

```

最后，将以下条目添加到 **crontab** 中:

```
@reboot /home/pi/reboot_hist.sh

```

然后，当我们重新启动时，它会将重新启动时间写入指定的日志文件。我重启了几次，然后检查了日志文件。内容如下:

```
pi@raspberrypi:~ $ cat reboot_hist.log
System rebooted at :
Thu Sep 10 20:04:42 IST 2020
System rebooted at :
Thu Sep 10 20:07:01 IST 2020

```

## 摘要

在这个简短的章节中，我们学习了 shell 的两个高级特性:I/O 重定向和 crontab 的使用。我们还看到了 crontab 条目的一个小例子。这两个特性在编写 shell 脚本时都非常有用。

通过这一章，我们结束了我们的 shell 脚本之旅。在下一章，我们将学习如何在 Linux 上用 C、C++和 Python 3 这样的高级编程语言编程。