# 6.在命令行上编辑文件

信不信由你，在 Linux 上你最终要花大部分时间做的事情之一就是编辑文本文件。它们无处不在，你会发现它们被用于内容、应用程序源代码、配置文件和启动脚本。原因是尽管它们有些基础和枯燥，但它们对于存储人类可读信息非常有用。当你把这一点和易用性结合起来，你就知道你是赢家了。Linux 没有像 Windows 那样的注册表，应用程序很少不使用文本文件进行配置。即使 Sendmail 有一个历史上很糟糕的配置文件(事实上非常糟糕，您需要为另一个应用程序编写一个配置文件，然后该应用程序将为您创建 Sendmail 配置文件),它也将其配置文件存储为普通的旧文本。

在这一章中，我们将给你一个文本文件的简要概述，以及它们今天是如何被使用的。然后，我们将介绍本章将要涉及的两个编辑器(nano 和 vim ),然后我们将进入本章的真正内容，并向您展示如何实际完成工作。

## 什么是文本文件？

当计算机在磁盘上存储数据时，它可以以两种格式之一存储数据。它可以将数据存储为文本文件，也可以存储为二进制文件。很自然地，当计算机把一切都存储为二进制数据(那些好的旧的 1 和 0)时，究竟是什么使文本文件不同于二进制文件呢？毕竟，文本文件肯定也必须以二进制格式存储。如果你沿着这些思路思考，那么你是非常正确的。与其说是数据本身如何存储，不如说是数据如何读取。

欣赏这种差异的最好方法是想想你现在正在读的这一页。你能理解我写的原因是因为我们已经默认使用英语交流。这一页的内容有我们都理解的结构。我们用大写字母开始句子，我们用标点符号来表示句子何时结束或何时停下来喘口气。简而言之，我们这里有一个相当复杂的协议，但它的工作，因为我们都有能力读和写英语。我们既能理解结构(如何读写数据)，也能理解语义(单词的实际意思)。那么，这句话怎么样:

早上好！你好吗？

我们马上就能看出这不是英语，毕竟，如果是英语，我们也能理解。除非你碰巧会说荷兰语(我们不会，但我们的好朋友会)，否则你可能不知道它是用哪种语言写的。即使内容没有意义，但结构本身有意义。我们可以看到我们有两个句子，一个是陈述句，另一个是疑问句。在这种特殊情况下，我们可以猜测第一个单词的意思。如果我们像英语一样发音，它听起来非常类似于 good morning(这实际上是这个词的翻译)。由此我们大概可以猜到问题是“你好吗？”。

我们可以这样做的原因是，尽管我们不理解内容，但荷兰语和英语有着共同的结构或格式。我们共享一个字母表(尽管荷兰语确实有一些英语中没有的字符)和标点符号(句号、逗号和问号)。现在你可能发音不正确(毕竟它是一门外语)，但是因为我们有共同的结构，即使我们不能理解它，我们至少可以处理它的内容。

图 [6-1](#Fig1) 更进一步。

![A978-1-4842-1162-5_6_Fig1_HTML.jpg](A978-1-4842-1162-5_6_Fig1_HTML.jpg)

图 6-1。

Some Chinese Text

至少对于这本书的一般读者来说，图 [6-1](#Fig1) 会是无法解释的。实际上，这两个句子和我们在荷兰的例子中出现的是一样的，但是这次是用简体中文写的。对于门外汉来说，没有办法从这些字符中判断出它们应该如何发音。事实上，根据不同的方言，这些汉字可以用不同的方式发音。这是因为每个字符代表一个想法而不是一个声音，一旦你认识到这个想法，你就知道该说哪个单词。这就是为什么在中国，两个不会说同一种语言的人，通过读写汉字，完全可以很好地交流。

那么，我们为什么要偏离正题去学习外语呢？嗯，文本文件就像读写英语或荷兰语。内容是否有意义取决于读者会说英语还是荷兰语。这类似于两个应用程序及其配置文件。如果您给 Sendmail 电子邮件服务器一个 Apache web 服务器配置文件，它会把它吐回给您(Sendmail 不会说 Apache)，但它可以打开并读取文件。

另一方面，中文是我们的二进制格式的例子。对于大多数西方人来说，这是非常陌生的(尽管可以说它比西欧语言中使用的语音书写要高效、优雅和复杂得多)。除非你懂中文，否则你无法理解内容或隐含的结构。用计算术语来说，你所拥有的是一个只有编写它的应用程序才有意义的原始数据块。

现在你可能认为以任意格式存储数据没什么大不了的。毕竟，写它的应用程序是会读它的应用程序，只要它理解文件，这就足够了。是也不是。如果程序中断会发生什么？如果您需要读取另一台机器上的文件，该怎么办？也许供应商已经提供了一些特殊的工具来做到这一点，但是问题就在这里——您需要特殊的工具。

文本文件则不然。文本文件可以在任何文本编辑器中打开，不需要特殊工具。由于绝大多数 Linux 应用程序都使用文本文件(我们想不出任何不使用文本文件的)，所以您需要阅读或更改配置文件的全部内容就是您最喜欢的文本编辑器，Linux 有多种编辑器可供选择。因此，您可以熟悉一个工具，然后使用该工具重新配置您的所有应用程序，在编写脚本时编写源代码，甚至用它来写书(这正是我们现在正在做的)。

## 竞争者

所以文本编辑器是你的 Linux 瑞士军刀，是你永远不想离开家的东西。当然，就像瑞士军刀一样，有许多不同的文本编辑器可供选择，也像瑞士军刀一样，有些比其他的功能更多。有时你想要一个基本的文本编辑器，让你打开文件，编辑一些文本，然后保存结果。其他时候，您可能希望进行复杂的搜索，并替换或删除到行尾。当然，你可以很容易地使用一个更有特色的编辑器来完成你的所有任务，毕竟，如果你不需要的话，你可以不使用这些特性。也就是说，根据我们的经验，人们通常至少熟悉两个文本编辑器，一个是基本的，一个是全功能的。在本书中，这分别意味着纳米和 vim。

我们要介绍的第一个文本编辑器是 nano。这是一个轻量级的，易于使用的文本编辑器，它倾向于安装在大多数系统上。一些较新版本的 nano 有更多的功能(例如编写源代码时的语法高亮显示)，但实际上看起来和工作方式都是一样的。如果你能在你的 Pi 上使用 nano，你就能在任何平台上同样很好地使用它。

Nano 实际上是作为 Pico 文本编辑器的替代品而编写的，Pico 文本编辑器过去与 Pine 一起提供，Pine 是一种基于文本的电子邮件客户端。Pico 仍然可以在较老的系统(通常更老)上找到，如果您找不到 nano，您可能仍然能够找到 pico。由于这是一个简单的替换，你习惯在 nano 中使用的相同的命令和基本特性也将在 pico 中可用。结合这一点，您可以了解大多数其他 Unix 平台以及 Linux。

Nano 的主要卖点是它的易用性，但它确实有许多有用的功能。然而，这些功能是从菜单中访问的，虽然它有足够的功能来简单地编辑配置文件，但有时您需要一些功能更强大的东西。这就是 vim 编辑器的用武之地。它能做 nano 能做的所有事情，但它能做的更多，这几乎是比较的终点。Vim 还具有语法高亮、不同的配色方案、剪切和粘贴、删除文本块、缩进文本块、打开多个文件并同时显示等功能。

现在您可能会想，如果 Vim 这么好，那么您只需学习如何使用这个文本编辑器就可以省去很多麻烦。像 nano 一样，它几乎在任何地方都以某种形式存在，它们都具有相同的基本功能，接受相同的命令。我们介绍 nano 的原因是，您可以在几秒钟内启动并运行。它的特点很容易解释，让它做你想做的事情真的很容易。尽管 vim 用户可能不同意，但根据我们的经验，vim 并没有获得任何易用性奖项。也就是说，如果你真的不想学习两个编辑器，并且觉得你宁愿只学习 vim，那也没关系，你不会真的错过任何东西，只是你可能需要更长的时间才能变得有效率。

THE HOLY WAR - VI VS EMACS

信不信由你，文本编辑器圣战(正如它已经成为众所周知的)已经持续了几十年，并且令人惊讶地比 Linux vs Windows 的争论更加激烈。事实上，它已经变得如此激烈，以至于 Richard Stalman(Emacs 的创始人和 GNU 自由软件基金会的创始人)装扮成来自“Emacs 教堂”的圣 Ignucius。他曾多次指出，“虽然 vi 是魔鬼的工具”(vi 在罗马数字中是 6)，“使用 vi 不是一种罪恶，而是一种忏悔”。当然，虚拟世界的人群不会坐以待毙，并形成了“虚拟世界的崇拜”。emacs 最强的特性之一是你可以写代码让它做任何你能想到的事情。这使得 vi 人群说“Emacs 是一个伟大的操作系统，只是缺少一个像样的文本编辑器！”。

没有人真的期待这场辩论会结束，尽管有时会变得非常激烈，但通常都是在良好的气氛中进行的。一天结束时，对你来说最好的文本编辑器是让你最有效率的，也是你最喜欢使用的。尽管如此，阅读一些火焰战争和阅读它的历史可以为那些寻找事情做的人提供很好的娱乐…

## 从纳米开始

我们从 nano 开始，原因很简单，它真的很容易使用，不需要太多解释。你可以在 nano 中做任何你需要做的事情，虽然在另一个编辑器中你可以做得更快，但是 nano 会帮助你很好地完成工作。

可以使用 Nano 命令运行 nano。好吧，这并不奇怪，但是运行 nano 本身并不那么有用。毕竟你现在有了一个文本编辑器，你想做一些编辑。除非做一些笔记，否则没有人会只是写下文字而不想事后保存。一般来说，当你打开 nano 时，你想打开一个特定的文件进行编辑。该文件可能存在，也可能不存在，但是当按下保存按钮时，你可能知道你想给它起什么名字。为了便于介绍，我们将打开 nano，告诉它我们想要编辑 test.txt。我们可以通过以下方式完成:

`[pi@raspberrypi ∼] $ nano test.txt`

一切正常的话，你应该得到这样的东西(图 [6-2](#Fig2) ):

![A978-1-4842-1162-5_6_Fig2_HTML.jpg](A978-1-4842-1162-5_6_Fig2_HTML.jpg)

图 6-2。

Freshly opened nano with a new file

我们已经使用 SSH 连接到我们的 Pi，但是因为 nano 是一个基于终端的应用程序，所以无论您如何运行它，它看起来都是一样的。关于这类终端应用的一个有趣的事情是，它们对你的终端有多大很敏感。固定终端(如物理控制台)有固定的屏幕尺寸。当您通过 SSH 连接或使用虚拟终端时，您可以调整屏幕的大小，这将导致 nano 随之调整大小。这使得它非常灵活，无论屏幕的形状或大小如何，都能满足您的需求。

### 那么这一切意味着什么呢？

Nano 的屏幕一开始可能会有点混乱(尤其是底部)，但大多数时候你实际上不会注意到除了文本之外的任何东西。事实上，所有其他的东西都在背景中消失了。例如，在你屏幕的左上方，你可以看到我们正在运行“GNU nano 2.0.9”。在写这本书之前，我们不知道我们运行的是什么版本的 nano，老实说，直到我们必须在这里描述它，如果有人要求我们凭记忆绘制 nano 布局，我们会很难做到这一点。事实上，我们根本做不到！

从 nano 的标题栏中还可以收集到另外两条信息。正中间的是你正在编辑的当前文件的名字。在我们的例子中，它是“/home/pi/test.txt”。不完全是惊天动地的，但同时在多个窗口上工作是很常见的，能够快速找到你的方位会派上用场。

第三条有用的信息是文件是否被修改过，即是否有任何未保存的更改。这也可以派上用场，因为虽然您可以简单地重新编写文件，但有时如果您从另一个位置编辑了文件，您不确定您所做的更改，您只想知道是否有任何更改没有反映在您正在编辑的文件中。它还可以简单地唤醒你的记忆，提醒你保存你的工作。要查看这是什么样子，只需按空格键进行更改(图 [6-3](#Fig3) ):

![A978-1-4842-1162-5_6_Fig3_HTML.jpg](A978-1-4842-1162-5_6_Fig3_HTML.jpg)

图 6-3。

Modified file in nano

标题栏差不多就是这样了。在屏幕的底部实际上有两个部分。第一个是状态栏，显示重要信息(现在它告诉你这是一个新文件)，第二个是快捷方式或菜单栏。我们不会对状态行说太多，因为它很容易理解。任何你需要知道的重要信息，纳米都会放在那里。更有趣的(事实上也是使用 nano 的关键)是快捷工具栏。我们在这里仔细看看(图 [6-4](#Fig4) ):

![A978-1-4842-1162-5_6_Fig4_HTML.jpg](A978-1-4842-1162-5_6_Fig4_HTML.jpg)

图 6-4。

The shortcut bar

当你在 Windows 或 Mac 上工作时，你可能已经到了不用鼠标来复制和粘贴东西，而是使用键盘组合的地步。在 Windows 上，您可以使用 control 和 c 键，而在 Mac 上，您可以使用 command 键和 c 键。当您同时使用多个键时，您最终会得到一个组合键。nano 的工作方式非常相似，但不是复制和粘贴，它所有的关键功能都是由组合键驱动的。因为要记住所有可能的选项有点困难(尽管你经常使用的选项会很快被你长期记忆)，nano 在快捷栏中显示它们。实际上，它只显示了最常见的命令，但我们从来没有必要偏离这些命令。

要使用任何命令，你需要使用正确的组合键。你可以通过查看快捷栏找到你需要的组合。书写“控制键”的简写方式是使用克拉或“^”符号。查看快捷栏，你可以看到，如果你想获得帮助，你需要使用“^G”，或者换句话说，按住控制键，并按下 g 键。

### 保存您的文件

保存一个空白的文本文件是非常无聊的，如果你只有一个空格，很难判断它是否保存正确。我们要在这里找一首老歌，敲入“玛丽有只小羊羔”。

与一些编辑器不同(最明显的是 vim，您稍后会遇到)，nano 没有不同模式的概念。也就是说，当您键入 nano 时，它将被解释为要放入文件中的文本。另一方面，Vim 以命令模式启动，如果您只是开始输入，您将会得到一些有趣的结果。正如您所料，在每一行之后按 enter 键会将您带到下一行的开头。输入童谣后，您应该会看到类似这样的内容(图 [6-5](#Fig5) ):

![A978-1-4842-1162-5_6_Fig5_HTML.jpg](A978-1-4842-1162-5_6_Fig5_HTML.jpg)

图 6-5。

Mary had a little lamb, nano style

我们把 nano 的窗口缩小了一点，这样我们就不会占用大量的空白空间。它也是一个很好的例子，说明了为什么你可能想要调整窗口的大小，以及当你实际这么做时它是什么样子的。在这种情况下，一切看起来都很好，虽然不可否认的是，要写一个合理长度的东西，你需要比这个大一点的东西。

你可能已经注意到状态线似乎已经消失了。这是因为一旦向文件中添加了任何内容，该文件就不再是新文件。我们修改过的警告仍然在右上角。是时候去掉它，让玛丽安全地进入磁盘了。

查看快捷工具栏，您可以看到我们可以使用的选项。你最常使用的是“写出”，意思是“保存文件”和“退出”。Exit 实际上是 WriteOut 的两倍，因为如果您试图在未保存更改的情况下退出 nano，它会询问您是否要保存更改。

让我们从 WriteOut 命令开始。按住 control 键并按下 O 键。Nano 现在看起来应该是这样的(图 [6-6](#Fig6) ):

![A978-1-4842-1162-5_6_Fig6_HTML.jpg](A978-1-4842-1162-5_6_Fig6_HTML.jpg)

图 6-6。

Using the WriteOut command

你会注意到我们这里有两个变化。首先是我们的状态线有所回升。这次它在询问信息，或者至少它想让我们确认。现在是保存文件的时候了，nano 要求我们确认文件名。因为我们在最初启动 nano 时给了它一个名称，所以这是 nano 默认提供的名称。如果我们现在按回车键，它将保存文件，但在我们这样做之前，让我们看看快捷栏。

您可以看到它变成了一套全新的选项。这是因为快捷栏实际上是与上下文相关的，也就是说，它会根据你当时正在做的事情向你显示最相关的内容。这些选项仅在保存文件时有用(甚至可用),所以这是你看到它们的时候。除了取消(当你突然决定根本不想保存时)，我们实际上从来没有使用过这些选项。

好了，回到保存文件。如果您愿意，您可以更改文件的保存名称，nano 不仅会以您的新名称保存该文件，而且当您返回编辑同一文件时，还会继续使用该名称，您应该会收到如下消息(图 [6-7](#Fig7) ):

![A978-1-4842-1162-5_6_Fig7_HTML.jpg](A978-1-4842-1162-5_6_Fig7_HTML.jpg)

图 6-7。

File has been written to disk

你可以看到快捷方式栏已经恢复了它通常的样子，并且我们的状态行中有了一条新消息。您还会发现修改后的状态已经消失了。目前为止一切顺利。

让我们快速看一下，如果您在拥有一个已编辑文件的情况下尝试退出 nano 会发生什么(图 [6-8](#Fig8) ):

![A978-1-4842-1162-5_6_Fig8_HTML.jpg](A978-1-4842-1162-5_6_Fig8_HTML.jpg)

图 6-8。

Exiting before saving

我们在这里所做的只是在文件中添加一个签名(尽管不可否认这可能不是 Mary 写的)，然后尝试使用 control 和 x 退出 nano。这一次，状态栏给了我们一个可怕的警告，快捷栏给了我们一些减少的选择。我们可以说“是”,在这种情况下，nano 将在退出前保存更改，或者我们可以说“否”,在这种情况下，nano 仍将退出，但我们将丢失自上次保存文件以来所做的所有更改。我们也可以更好地考虑退出，改变我们的想法。在这种情况下，我们可以使用 control plus C 取消我们的退出请求，这将把我们带回 nano。

### 在纳米里移动

你可以通过使用光标键来移动你的文本，就像你可能习惯于使用你选择的文字处理器一样。事实上，我们在这里提到这一点的唯一原因是因为一些编辑器根本不使用这些键，因为它们让你的手离开主行太远(也就是说，它们使用起来很慢，因为你必须移动你的手很长的距离才能够到它们)。因此，与其解释光标键，我们将向您展示我们在 nano 中最常用的两个功能，这两个功能恰好都与查找内容相关。

第一件事你可能会想使用的是搜索功能，有点奇怪的命名为“在哪里”在纳米。我们可以通过按 control 和 W 键来发出命令，以进入下一步(图 [6-9](#Fig9) ):

![A978-1-4842-1162-5_6_Fig9_HTML.jpg](A978-1-4842-1162-5_6_Fig9_HTML.jpg)

图 6-9。

Searching for some text

我们又有了一些新的选择。最常见的任务是简单地找到一个单词。所以让我们搜索玛丽，看看会发生什么(图 [6-10](#Fig10) ):

![A978-1-4842-1162-5_6_Fig10_HTML.jpg](A978-1-4842-1162-5_6_Fig10_HTML.jpg)

图 6-10。

Nano found Mary

按下回车键后，nano 将尝试找到您搜索的文本。在我们的例子中，我们已经到了文件的末尾，这就是为什么你可以在状态栏中看到“Search Wrapped”——nano 到达了文件的末尾并绕回以从开始处继续搜索。这是一个非常方便的功能！

你要找的单词会出现不止一次，这是很常见的。如果你想要第二个玛丽，你会想重复你的搜索。只需按下 control 和 W，然后立即按下 enter 键，就可以做到这一点。Nano 会记住你上次搜索的内容，如果你不提供新词，它会用旧词再次搜索。这意味着您可以轻松地在文档中循环查找您正在寻找的特定条目。

我们要介绍的最后一个特性是一种稍微更具体的搜索形式。我们不想搜索一个单词，而是想找到一个特定的行号。在日常的文本编辑中，你实际上不会经常这么做。然而，当您开始编写脚本并且它们产生错误时，您通常会被告知错误发生在哪一行。对于短程序来说，这通常并不重要，但是如果你正在构建一个相当宏大的东西，你会希望能够快速地到达那一行。即使在中等长度的程序中也是如此，因为如果你有一个特别棘手的问题，你将不得不重新访问一段特定的代码，而且你肯定不希望每次都必须使用光标键来找到它。

要转到特定的行号，您需要像之前一样使用 control+W 开始搜索，但不是键入任何文本，而是应该使用 control + T。这将把状态行更改为(图 [6-11](#Fig11) ):

![A978-1-4842-1162-5_6_Fig11_HTML.jpg](A978-1-4842-1162-5_6_Fig11_HTML.jpg)

图 6-11。

Go to a specific line number

你所要做的就是输入你想去的行号，然后按回车键。您还可以看到这里有一些其他有用的选项，允许您分别转到文件的开头和结尾。您也可以按下 command 和 T 键返回到搜索文本，或者按下 command 和 C 键取消搜索。

### 包装纳米

这就是我们将为 nano 介绍的全部内容，但是正如您所看到的，即使是我们介绍的有限的功能，也已经让您能够编辑配置文件，甚至编写自己的书。Nano 非常适合那些你不想分心，只想完成工作的任务。碰巧的是，这本书的大部分内容都是用 nano 编写的，这表明这个工具不仅仅是一个玩具！也就是说，现在让我们来看看 vim 编辑器能为您提供什么…

## Vim 入门

Vim 比 nano 高级一点。尽管 nano 被设计得非常简单，但 vim 被设计成一个功能齐全的环境，可以执行各种任务。您甚至可以将其他应用程序(如 shell 和源代码控制)直接与 vim 集成，这意味着您可以在不离开文本编辑器的情况下完成大量工作。

这种原始力量的缺点是你必须学会如何使用它。与基本上可以立即使用的 nano 不同，vim 有模式的概念。一般来说，您要么处于正常模式，要么处于插入模式，这就是我们将在本节重点讨论的内容。

然而，我们想指出的是，即使我们自己经常使用 vim，我们也不是你所说的 vim 专家。我们知道如何使用有助于我们工作的功能，但是有大量的功能我们没有使用或者甚至不知道。由于这只是关于 vim 的初级读本，我们不认为这是一个问题，但是如果您认为 vim 是适合您的工具，那么有大量专门介绍 vim 的书籍以及大量关于它的一些更高级和更强大的特性的视频教程。

与其再打一首诗，不如让我们再给玛丽一次机会，让她回到 vim 的舞台上:

`[pi@raspberrypi ∼] $ vim test.txt`

不用说，启动 vim 和启动 nano 一样简单，但一旦启动，它看起来确实有点不同(图 [6-12](#Fig12) ):

![A978-1-4842-1162-5_6_Fig12_HTML.jpg](A978-1-4842-1162-5_6_Fig12_HTML.jpg)

图 6-12。

Starting up vim

漂亮的标题、状态行和快捷栏都不见了。在 vim 领域，就像 Linux 本身一样，我们应该知道自己在做什么。在屏幕的左下方，您可以看到我们正在编辑的文件的名称。接下来是 6L，它告诉我们文件中有多少行，后面是 115C，它告诉我们字符数。在屏幕的另一边，我们有另一条有用的信息 1，1。这告诉我们当前所在的行和所在的列。现在它告诉我们，我们在第一行第一列。这是有意义的，因为我们刚刚打开文件，如果你看光标，肯定我们已经坐在第一个 m 的上面。

Note

根据 vim 的版本和配置方式，它通常会将您带到上次停止编辑该文件时的位置。这在编程时真的很有用，因为它能让你立即到达动作发生的地方。

您还可以在文件的最后一行下面看到几行波浪号“∨”。这些在这里提醒我们，虽然屏幕有一定的大小，但玛丽下面没有内容。这在进行某些类型的编程时特别有用，并且您希望确保没有额外的空白。这真的只是一个视觉线索，不会妨碍你。

### Vim 的模式

Vim 给人的感觉有点奇怪，因为不像文字处理器和更基本的文本编辑器，使用 vim 你不能马上开始输入。这是因为 vim 有不同的模式或个性。当您第一次启动 vim 时，它处于命令模式。与 nano 使用组合键发出命令不同，vim 有大量单字母或双字母命令。你可能会认为这非常令人困惑，但是你是对的。一旦您知道了让 vim 执行您的命令的神奇按键，您就会喜欢这种控制文本编辑器的方式。然而在那之前，它可能会让你分心。

所以让我们离开命令模式，进入更舒适的状态。我们可以通过按“I”键在 vim 中复制一个 nano 风格的环境。这将使我们脱离命令模式，进入插入模式。当你处于这种模式时，你可以分辨出来，因为你在左下角得到–插入(图 [6-13](#Fig13) ):

![A978-1-4842-1162-5_6_Fig13_HTML.jpg](A978-1-4842-1162-5_6_Fig13_HTML.jpg)

图 6-13。

Vim in insert mode

此时，您可以像使用 nano 一样在文本文件中移动。光标键按预期工作，您可以像在 nano 下一样添加和删除文本。当你想做除了写文本以外的事情时，这种差异就开始了。你如何保存你的改变？

### 保存您的更改

要在 vim 中保存您的更改，您需要做的第一件事是退出插入模式。这将把您带回到正常模式，在这里您可以发出命令，从而可以保存您的文档。首先，让我们把签字人改为约翰。这将为我们提供文档急需的更改。为了实际保存文档，我们使用以下命令:

`:w`

该命令实际上是一个冒号后面跟着一个小写的 W。Vim 区分大小写，因此如果您尝试这样做:W，您将得到一条错误消息，表明它不是有效的命令(图 [6-14](#Fig14) ):

![A978-1-4842-1162-5_6_Fig14_HTML.jpg](A978-1-4842-1162-5_6_Fig14_HTML.jpg)

图 6-14。

Whoops, W isn’t a command

不过不必惊慌，只需再次尝试该命令，您就会没事(图 [6-15](#Fig15) ):

![A978-1-4842-1162-5_6_Fig15_HTML.jpg](A978-1-4842-1162-5_6_Fig15_HTML.jpg)

图 6-15。

:w on the other hand works like a charm

如果您想在保存时更改文件名，您可以简单地在命令后键入您想使用的文件名，如下所示:

`:w test2.txt`

这将保存对新文件名的更改，然后继续编辑新文件。

### 走出维姆

这使我们只剩下一个新的功能，让您达到与 nano 相同的基本水平(我们稍后将介绍搜索)。一旦你完成了所有的编辑并保存了文件，你就会想要退出。用于此目的的命令是:

`:q`

只要您没有做任何更改，vim 将立即退出，您将回到命令行。然而，如果你已经做了一些改变，并且你试图这样做，你会再一次被 vim 激怒(图 [6-16](#Fig16) ):

![A978-1-4842-1162-5_6_Fig16_HTML.jpg](A978-1-4842-1162-5_6_Fig16_HTML.jpg)

图 6-16。

To quit without saving you’ll need an override

幸运的是，vim 已经告诉我们如何修复这个问题，但是基本上，如果您想在不保存更改的情况下退出，您需要明确地告诉 vim 这是您想要做的:

`:q!`

这就是离开维姆的全部！

### 在 Vim 中搜索

在这一节中，我们将只介绍基础知识，并向您展示如何进行与 nano 中相同的搜索。事实上，vim 具有非常高级的搜索功能(一开始可以使用正则表达式——参见 boxout ),但是当您在使用中变得更加高级时，您可能会依赖这些功能，但是您可能仍然会发现您大部分时间都在做简单的事情。

要在 vim 中搜索一个单词，您需要做的就是在它前面加上一个正斜杠。要尝试这样做，请在命令模式下(轻按两次 escape 键以确保您处于正确的模式)键入:

`/Mary`

这将找到 Mary 的所有实例，并为您突出显示它们(图 [6-17](#Fig17) ):

![A978-1-4842-1162-5_6_Fig17_HTML.jpg](A978-1-4842-1162-5_6_Fig17_HTML.jpg)

图 6-17。

Vim found Mary

你可以看到“搜索触及底部，继续在顶部”的信息，这相当于纳米的“搜索包装”。使用 vim 需要注意的一点是，因为它使用正则表达式进行搜索，所以默认情况下也是区分大小写的。这意味着如果你搜索的是 mary 而不是 Mary，你会收到投诉(图 [6-18](#Fig18) ):

![A978-1-4842-1162-5_6_Fig18_HTML.jpg](A978-1-4842-1162-5_6_Fig18_HTML.jpg)

图 6-18。

Vim can’t find mary

vim 优于 nano 的一个方面是如何进行重复搜索。要移动到下一个搜索结果，您只需按“n”键。在上面的示例文本中，如果您使用/Mary 搜索 Mary，然后一直按“n ”,您将看到 vim 会为您循环搜索结果。我们无法在出版物中展示这种影响，但如果你不想做其他事情，这是一个很好的分散注意力的几秒钟。如果你想在相反的方向搜索(例如，向文件的顶部而不是底部),只需使用大写字母“N”即可。

REGULAR EXPRESSIONS

右手中的正则表达式就像魔术一样。他们处理复杂的文本处理任务，就像一把热电锯穿过温热的黄油。他们还经常被用来给系统管理员尿床的噩梦，并吓唬小孩子。一旦你知道如何使用正则表达式，它就非常强大，但是这种强大是有代价的。尽管如此，正则表达式的基本知识将对您非常有用，您可以在 vim 中直接使用它们来搜索、替换和操作您的文本。

我们在这里没有足够的空间来讨论正则表达式(通常简称为 regex ),但是互联网上有一些很棒的资源可以帮助您入门，更不用说关于这个主题的完整书籍了。一个很好的起点是 Jan Goyvaerts 的网站 [`http://www.regular-expressions.info/`](http://www.regular-expressions.info/) 。这个网站不仅充满了有用和有帮助的信息(它经常是我们的第一站)，而且 Jan 还编写了一些非常强大的软件。我们在很多年前购买了 RegexBuddy，当我们试图调试一些复杂的正则表达式时，它仍然是我们的第一选择。如果你想要一个简单的工具来测试你的正则表达式，看看 [`http://rubular.com/`](http://rubular.com/) ，它用 Ruby 做实时正则表达式解析。

我们在 nano 中讨论的最后一件事是移动到特定的行号。这在 vim 中实际上要容易得多，可能是因为这是程序员必须一直做的事情。要跳转到特定的行号，只需将行号放在冒号后面。例如，要跳到第 5 <sup>行</sup>行，您需要做的就是:

`:5`

一旦你按下回车键，你将被直接带到第 5 <sup>行</sup>行。和以前一样，这个特性对于普通编辑来说不是特别有用，但是当你摆弄一个 simplify 拒绝按照你知道的方式工作的程序时，它就非常方便了！

### 在维姆四处走动

虽然我们已经向您展示了如何在文本文件中移动，但是我们还没有利用 vim 的强大功能。Vim 提供了额外的命令，可以让我们更快地浏览文本。

在命令模式下，你仍然可以使用光标键来移动你的文本，这很好也很方便。实际上，您可以使用另外两个命令，即“h”和“l”键来做同样的事情。h 键将光标向后移动一个字符，l 键将光标向前移动一个字符。诚然，这不是很令人兴奋，但我们现在可以引入' b '和' w '命令。它们的工作方式和前面的命令一样，不仅仅是后退一个字符，而是跳到单词的开头。突然，这变得更有用了，因为现在如果你有一长串的文本，而不是长时间按住光标键(很诱人，不是吗？)，一次跳一个字就可以大大加快进程。

不过，我们可以更进一步。如果你想跳到一行的开头，你可以按“0”(零)键。要到达行尾，只需使用$(在我们的例子中，这意味着按住 shift 键并按下 4 键)。这非常有用，因为很多时候你想找到一行的开头或结尾，现在你只需按一个键就可以了。

让我们把它放在一个表格里，这样会更清楚一点:

<colgroup><col> <col> <col> <col> <col> <col></colgroup> 
| 行首 | 后退一个单词 | 后退一个字母 | 转发一封信 | 前进一个单词 | 行结束 |
| --- | --- | --- | --- | --- | --- |
| Zero | b | h | l | w | $ |

所以我们现在有一个渐进的方法来将光标从线的一端移动到另一端。我们再也不用摆弄回车键或空格键，或者等着光标在屏幕上滚动时睡着。这仅仅是个开始，因为这些键不仅仅可以用来移动文件，还可以用来指定输入 vim 的命令的范围。

### 在 Vim 中删除

要删除一个字符，你只需要按“x”键。这将删除当时光标下的任何字母。这本身有时是有用的(通常是在修改一个错别字的时候)，但是它并没有给你带来比进入插入模式更大的优势。然而,“d”键提供了一个非常强大的删除命令，您现在可以结合您新获得的移动光标的知识来做一些非常令人印象深刻的事情。

我们要尝试的第一个删除命令是“dd”。让我们从删除文件中的第一行开始。为了确保我们都在正确的位置，使用下面的命令返回到第一行:

`:1`

现在，我们将通过键入以下命令来删除当前行:

`dd`

你的诗现在应该短一些，看起来像这样(图 [6-19](#Fig19) ):

![A978-1-4842-1162-5_6_Fig19_HTML.jpg](A978-1-4842-1162-5_6_Fig19_HTML.jpg)

图 6-19。

Deleting the first line

既然我们已经毁了我们的诗，现在是引入 vim 中另一个非常有用的特性——“撤销”命令的好时机。要取消我们刚才所做的更改，只需按“u”键，Mary 就会恢复往日的光彩。这不仅可以防止意外删除错误行时的恐慌，还意味着我们可以用许多有趣的方式删除这一行的一部分。

如果您想要删除多行代码，您可以通过在命令前面加上一个数字来告诉 vim 您想要它执行一个特定命令的次数。例如，如果我们想从我们的诗中删除三行，我们可以这样做:

`3dd`

这相当于按下 d 键六次，并给你这个快乐的结果(图 [6-20](#Fig20) ):

![A978-1-4842-1162-5_6_Fig20_HTML.jpg](A978-1-4842-1162-5_6_Fig20_HTML.jpg)

图 6-20。

Deleting three lines in one go

您可以在左下角看到，正如我们所希望的那样，现在“少了 3 行”。让我们用“u”键恢复 Mary，并尝试其他方法。将光标放在第一行的开头，尝试执行以下命令:

`dw`

这个命令结合了删除命令和我们前面看到的移动命令。在这种情况下，我们将它与“w”结合，表示“向右一个单词”。我们可以在这里看到该命令的效果(图 [6-21](#Fig21) ):

![A978-1-4842-1162-5_6_Fig21_HTML.jpg](A978-1-4842-1162-5_6_Fig21_HTML.jpg)

图 6-21。

Deleting a single word

我们没有移动光标本身，而是有效地选择了我们想要删除的文本。在这种情况下，“d”将从光标的当前位置开始删除，直到下一个单词的第一个字母。我们可以通过多次按下“x”键轻松实现这一效果，但使用“dw”显然更快、更精确。让我们再更进一步，结合我们所知道的。我们知道，通过在命令前面加上一个数字，我们可以让 vim 多次执行一个命令。我们还知道，我们可以将“d”命令与“w”结合起来删除一个完整的单词。让我们唤醒 Mary(再次按下“u”键)并尝试这个新的改进命令(图 [6-22](#Fig22) ):

![A978-1-4842-1162-5_6_Fig22_HTML.jpg](A978-1-4842-1162-5_6_Fig22_HTML.jpg)

图 6-22。

Deleting two words at once

`2dw`

那不是很有趣吗？我们已经能够组合一系列命令来表达一些相当复杂的任务。你当然可以以任何方式组合这些。例如，如果您想删除行尾的所有内容，可以使用 d$。如果您想删除从该行开始的所有内容，可以使用 d0。能够以这种方式组合命令使得 vim 成为处理文本的强大工具。尽管这些特性在处理英语散文时用处有限，但当你开始处理编程语言时，它们确实变得非常有用。

### 杂项小命令

在我们继续研究 Vim 的可视化模式的一些特性之前，我们将快速概述一下其他一些将会派上用场的简单命令。“I”进入插入模式，但有时您想在当前行的上方或下方书写。你可以通过分别使用 O 和 O 得到这个效果。这两种方法都会插入一个新行，然后切换到插入模式。有时你不需要实际编辑文件的内容，你只需要改变一个字母。这可能是因为打字错误，或者你只是想增加一个数字。您可以使用“r”键来完成此操作。这允许您用任何其他字符替换光标下的字符。只需按下“r ”,然后输入要替换的字符。简单却很有效！

## 视觉模式

我们自己并不经常使用视觉模式，但是当我们使用它的时候，它通常会节省我们大量的时间和精力。此模式允许您选择或突出显示文本块，以便进一步处理。这类似于在文字处理器中用鼠标高亮显示文本。有两种方法可以进入视觉模式，按“V”键或“V”键。如果你使用大写的 V，你将能够根据行选择一个文本块。使用小写 v，您可以获得额外的精度，因为您可以基于单个字母而不是整行进行选择。总的结果是一样的，你的选择只取决于哪一个对你来说最方便。

那么视觉模式到底能做什么呢？它本身并不做任何事情，它只是提供了一种简单的方法来告诉 vim 下面的命令应该应用于什么文本。按照我们之前的例子，让我们选择玛丽的诗的一大块。您不需要突出显示我们拥有的确切文本，而是尝试获得一个相当随机的块(图 [6-23](#Fig23) ):

![A978-1-4842-1162-5_6_Fig23_HTML.jpg](A978-1-4842-1162-5_6_Fig23_HTML.jpg)

图 6-23。

Highlighting text in visual mode

正如你从突出显示中看到的，我们使用了小写的“v”选项，因为我们想要突出显示某个特定的单词。除了一种戏剧性的感觉之外，没有其他真正的原因，所以它可能很容易是一串用“V”选择的线条。现在让我们应用我们最喜欢的命令，删除命令。按“d”你会发现高亮文本神奇地消失了。在这种情况下，您不需要向 vim 提供额外的信息来告诉它删除什么，因为实际上您已经通过在第一个位置高亮显示文本告诉了它。

当然，除了删除文本，你还可以做其他有趣的事情(尽管删除文本很有趣)。例如，如果要缩进这首诗的前两行，可以用 V 突出显示前两行，然后使用大于号和小于号( >和< respectively) as appropriate. We can’t show you how that would look in print (honestly moving huge chunks of text back and forth is surprisingly theraputic) but we can show you the end result of this command (Figure [6-24](#Fig24) ):

![A978-1-4842-1162-5_6_Fig24_HTML.jpg](A978-1-4842-1162-5_6_Fig24_HTML.jpg)

图 6-24。

Indenting highlighted text

还有一个非常有用的特性我们还没有谈到，它非常适合视觉模式——复制和粘贴。

### 复制并粘贴 Vim 样式

在终端中复制和粘贴是一个不确定的命题。原因是运行在终端中的应用程序实际上生活在它自己的小世界中。例如，如果您从笔记本电脑的终端上复制文本，该文本将被复制到笔记本电脑的剪贴板上。远程应用程序(在本例中是 vim)不知道您这样做了。同样，如果你把笔记本电脑上的内容粘贴到 vim 中，vim 会简单地接收到一组击键，它不会知道这些内容来自剪贴板。一般来说这是可以的。如果你只是想移动一些文本，那么以这种方式使用剪贴板可能是好的。

有些时候，这并不能如你所愿。例如，如果你有一个分屏，你有两个并排的文件，你想选择左边的第一段，你现在有点卡住了。终端只是向你展示服务器上的内容，它只是一个显示器，因此终端并不真正了解它在显示什么。如果你试着复制和粘贴左手边，你会发现右手边也跟着来了。这远非理想(更不用说高度刺激性)。

您可能遇到的另一个问题是，您可能希望 vim 对文本做一些事情。如果你只是想粘贴一次，没什么大不了的，但是如果你想粘贴正好 10004 次呢？Vim 在那里帮不了你，因为它对你的本地剪贴板没有概念。你会发现，当这些问题突然出现时，它们会变得相当小众，你可以绕过它们。然而，这很可能会激怒你，因为你会想“要是我能复制这篇文章就好了！”当你坐在那里试图解决问题的时候。

我们需要的是一个远程剪贴板，远程应用程序可以在这里存储数据进行处理。这方面没有标准，但是许多基于终端的应用程序提供了一个解决方案，在 vim 的例子中，它提供了拖拽和粘贴功能。要提取某些内容，您需要使用“y”键。这使用了与' d '命令相同的修饰符，因此您可以非常愉快地用' yy '复制一整行(记住，字母只是对折)，用' yw '复制一个单词。同样像删除命令一样，我们也可以在可视模式下使用它。

首先，只需突出显示您想要复制的文本。为了简单起见，我们再来看看上面两行。用“V”键高亮显示后，按“y”键将其拖入剪贴板。这是第一阶段的完成，现在我们要做的就是把它粘贴回我们的文件。有两种方法可以将 paste 命令与' P '或' P '一起使用。与“V”和“V”命令一样，大写和小写版本通常以某种方式相关联。在这种情况下,“P”键在当前行之前插入内容，而“P”键在当前行之后插入内容。在点击其中一个键之前，请随意将光标移动到文件中的任何位置。效果确实如您所料，vim 只是将内容粘贴进去。当然，您可以将这些命令与数字前缀结合起来，重复插入内容的次数。下面是如果你结束 40p 会发生什么(图 [6-25](#Fig25) ):

![A978-1-4842-1162-5_6_Fig25_HTML.jpg](A978-1-4842-1162-5_6_Fig25_HTML.jpg)

图 6-25。

Mass pasting

虽然你还不知道，但你实际上已经学会了剪切和复制文本。每当您使用“d”键时，您会从文件中删除文本，但副本会放在剪贴板中。如果您选择了一行并用' dd '删除它，您可以用' P '恢复它。请记住，如果您使用' p '键，因为您已经删除了该行，您实际上将在您当前所在的行之后插入原始行。如果要将其恢复到原始位置，必须使用' P '键粘贴到当前行之前。

## 摘要

在本章中，我们已经了解了文本文件和二进制文件的区别，以及为什么文本文件是配置软件的通用语言。我们已经讨论了您在旅行中可能会遇到的两个关键文本编辑器，并且我们已经为您提供了这两个编辑器的良好基础。当然，我们不能向你展示所有可能的事情，但是现在你应该可以自己探索和尝试新事物了。

在下一章中，我们将介绍 BASH shell，并向您展示一些系统管理员需要了解的更重要的事情…