# 2.文件/文件夹导航

无论您在终端中做什么，您都希望知道自己在系统文件结构中的位置。您还想知道如何导航到其他文件夹，这些文件夹中有您可能需要处理的文件。在这一章中，我们将重申基础知识，并看看导航文件系统的其他工具和方法。

## 基础

终端上的任何人都应该知道的最基本的命令是列出结构的`ls`和改变目录的`cd`。输入`ls`将会返回你当前目录下的文件和文件夹列表，然后你可以移动到带有`cd`后跟目录名的目录。表 [2-1](#Tab1) 列出了一些可以和`-ls`一起使用的有用选项。

表 2-1

ls 的选项

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"></colgroup> 
| 

命令

 | 

描述

 |
| --- | --- |
| ［构成动植物的古名或拉丁化的现代名］ | 显示隐藏的文件和目录 |
| -颜色 | 彩色高亮输出 |
| -福 | 文件名末尾表示类型的符号 |
| ［构成来自拉丁语、结尾为-us 的名词的复数］ | 显示文件索引号(*索引节点号* |
| -我 | 带细节的长格式 |
| 相当于-ED | 按日期时间排序 |
| 构成名词复数 | 按文件大小排序 |
| -r | 倒序 |
| -右 | 递归列出当前文件夹和子文件夹 |

虽然`ls`有几个常用的选项，但`cd`几乎从不与选项一起使用，尽管它有两个选项:`-P`不跟随符号链接，`-L`强制跟随符号链接。虽然你在使用`cd`时不需要选项，但有几个符号你应该知道。

导航时，有一些全局符号可用作表 [2-2](#Tab2) 所示路径的一部分。

表 2-2

目录符号

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"></colgroup> 
| 

命令

 | 

描述

 |
| --- | --- |
| 。 | 表示当前工作目录 |
| .. | 表示包含工作目录的文件夹 |
| ~ | 代表当前用户的主文件夹 |

当使用`ls`或`cd`时，这些简短的形式很方便；我们可以在文件系统的任何地方，如果我们想回到我们的主文件夹，我们可以简单地运行

```sh
cd ~

```

## 节点

我们提到过`ls -i`会返回一个文件索引号或者 inode 号，但是 inode 到底是什么？每次在 Linux 系统上创建文件时，都会在后台为它分配一个 inode。每个索引节点指向内存中文件所在的位置，以及与文件相关的元数据，包括文件大小、文件所有者和上次访问时间。

系统上的所有 inodes 都存储在一个表中，该表预先分配了一定数量的内存。这样做的一个有趣的副作用是，您可以在不耗尽磁盘空间的情况下耗尽文件空间。为此，您需要创建足够小的(*或空的*)文件来填充 inode 表，这几乎从来不会发生。要想知道可以存储多少个索引节点，可以运行

```sh
df -i

```

您将得到一个列表，其中包含系统中每个驱动器的一个名为`IFree`的列；这表示驱动器上的可用信息节点数量。在我的例子中，我有超过 650 万个空闲索引节点；因此，为了达到索引节点的最大数量，我必须创建超过 650 万个文件。

虽然可能性不大，但还是有可能的。如果您很好奇，想要模拟用完空闲的 inode，这里有一个将用完所有 inode 的 liner。在使用它之前，请确保您在`/tmp`文件夹中，这样如果您需要重新启动，所有文件将在下次启动时消失。

```sh
cd /tmp
mkdir test
cd test
for i in $(seq 1 7000000) ; do touch $i ; done

```

您需要用一个大于您的驱动器上的空闲 inodes 总数的数字来替换`7000000`。该命令纯粹是出于教育目的，可能需要几个小时才能完成。用完索引节点的情况非常罕见，但是在长时间运行且内存有限的系统上尤其会发生。

## 获取当前位置

每当你打开一个新的终端，你可能会在你的用户的主目录。因此对于用户`ubuntu`，您将在`/home/ubuntu/`中。情况并非总是如此，有时你会发现自己忘记了自己的位置。您可以通过运行以下命令找到您的当前位置

```sh
pwd

```

这将返回到您当前位置的完整路径。它代表“打印工作目录”

## 符号链接

在某些情况下，目录本身不是文件夹，而是另一个目录的快捷方式。这些被称为符号链接，或软链接。您可以通过运行以下命令为现有文件创建符号链接

```sh
ln -s original_file link_file

```

这将在指向`original_file`的工作目录中创建一个名为`link_file`的文件。这个新的符号链接文件本身不包含任何数据。符号链接只包含它作为别名的文件的文件系统地址。这意味着当移动或重命名别名文件时你必须小心，因为系统链接仍然指向原始位置。

当使用列表结构命令`ls -l`的详细版本时，你会看到一个从`link_file`指向实际文件位置的箭头(图 [2-1](#Fig1) )。在这里，`-l`旗实际上代表“长”。

![../images/494886_1_En_2_Chapter/494886_1_En_2_Fig1_HTML.jpg](../images/494886_1_En_2_Chapter/494886_1_En_2_Fig1_HTML.jpg)

图 2-1

系统链接文件的详细信息

或者如果你使用`ls -F`，你会在文件末尾看到一个`@`符号，它是符号链接，如图 [2-2](#Fig2) 所示。

![../images/494886_1_En_2_Chapter/494886_1_En_2_Fig2_HTML.jpg](../images/494886_1_En_2_Chapter/494886_1_En_2_Fig2_HTML.jpg)

图 2-2

符号@指定系统链接

符号链接也可以应用于文件夹，使一个文件夹成为另一个文件夹的快捷方式。

## 硬链接

除了符号链接，还有硬链接。硬链接是指向文件的信息节点的文件克隆。删除只有一个硬链接的文件的硬链接(目录条目)也会删除该文件。多个硬链接可以指向同一个 inode，只要它们都在同一个文件系统中。删除一个或多个指向某个信息节点的硬链接不会删除该信息节点或它所指向的文件，直到所有硬链接都被删除。另一方面，符号链接只是指向原始文件的快捷方式。与符号链接不同，硬链接不能应用于文件夹，只能应用于文件。

创建硬链接类似于创建符号链接，但没有`-s`标志:

```sh
ln original_file link_file

```

使用`ls -l`或`ls -F`，您将无法将硬链接识别为特殊类型的文件。本质上，它是一个与原始文件平等的普通文件；改变一个就会改变另一个。这是因为两个文件都指向同一个 inode，而这个 inode 又指向文件的一个实例。这意味着不像软链接，你可以移动任何一个文件的位置而不影响链接。

如前所述，Linux 系统上的每个文件都有一个关联的 inode。通过使用`ls -i`，我们可以看到当前目录中每个文件的 inode。图 [2-3](#Fig3) 显示了在硬链接和原始文件上使用`ls -i`的示例；请注意，inode 是相同的。

![../images/494886_1_En_2_Chapter/494886_1_En_2_Fig3_HTML.jpg](../images/494886_1_En_2_Chapter/494886_1_En_2_Fig3_HTML.jpg)

图 2-3

'`ls -i`'的输出显示了具有相同信息节点号的两个文件

即使移动文件，inode 也保持不变。指向 inode 的目录条目从一个目录移动到另一个目录。索引节点保持不变，索引节点和属于该文件的数据的位置也保持不变。

### 带有 pushd 和 popd 的导航堆栈

`cd`和`ls`是众所周知的，但是一旦你熟悉了导航文件目录，还有一些命令可以派上用场。第一个是`pushd`。`pushd`的行为类似于`cd`，但是它创建了一个目录堆栈，这样你以后可以很容易地返回到你当前的目录。例如，假设你在目录`/tmp/`中，你使用`pushd ~`，这将把你移动到主目录，就像`cd`一样，接下来做`pushd /usr/local/bin`。这又一次改变了你的位置，就像'`cd`'，但是图 [2-4](#Fig4) 中返回了我们访问过的位置列表。

![../images/494886_1_En_2_Chapter/494886_1_En_2_Fig4_HTML.jpg](../images/494886_1_En_2_Chapter/494886_1_En_2_Fig4_HTML.jpg)

图 2-4

pushd 堆栈中显示的文件夹位置列表

当前目录显示在左边，堆栈目录的最下面显示在右边(在我们的例子中是*`/tmp`)。现在，如果我们运行`popd`，我们将从堆栈中弹出当前目录，并向右移动一个目录，在本例中是`~`；然后再次运行它，我们将返回到`/tmp`。当你想跟踪一组要返回的目录时，这可以是一个有用的选择`cd`。*

 *另一个相关的命令只是运行`cd -`。当您在`cd`后使用减号时，您实际上将导航到您之前所在的任何目录；你可以重复这几次回溯所有你访问过的目录。

## 看守人

我最常用的另一个 Linux 命令行程序是 Ranger。Ranger 是一个命令行程序，它使文件和目录浏览变得快速而简单，尤其是在没有基于 GUI 的目录浏览器的服务器或设备上。

通过运行以下命令安装 ranger

```sh
sudo apt-get install ranger

```

安装完成后，只需在要启动的目录中运行命令即可启动它:

```sh
ranger

```

您将得到如图 [2-5](#Fig5) 所示的三窗格视图。按向上和向下将改变您在中间窗格的选择。按右进入右侧显示的目录，按左浏览父目录。

![../images/494886_1_En_2_Chapter/494886_1_En_2_Fig5_HTML.jpg](../images/494886_1_En_2_Chapter/494886_1_En_2_Fig5_HTML.jpg)

图 2-5

使用 Ranger 导航

以这种方式航行将很快成为第二天性。受 Vim 中绑定的启发，Ranger 还提供了几个键盘快捷键。我最喜欢的包括

*   s——输入大写字母`S`将打开在最左侧窗格中选择的目录，该目录将在 bash 会话中打开。从那时起，如果您按 ctrl+d 或手动运行`exit`，您将返回到 Ranger。

*   s——输入小写字母`s`将在屏幕左下方打开一个小文本框，可以在其中输入 shell 命令。例如，导航到`/tmp`，按下`s`后，输入命令`mkdir hello`，然后按回车键。您将看到一个名为`hello`的新目录出现在`/tmp`中。

*   q-输入大写`Q`将退出 Ranger 并返回到命令行。

*   @–键入`@`符号将允许您在不离开 Ranger 的情况下输入 bash 命令，例如，您输入`touch hi`并按 enter，您会看到您所在的当前目录添加了一个同名的空文件。

*   ~–键入`~`符号将在三级目录视图和一个只关注当前视图的视图之间切换；再按一次返回。当您处理长文件夹名称或不想分心时，较大的视图非常有用。

*   o–输入小写字母`o`将显示当前目录中文件排序的可能方式列表，例如，按时间变化或字母顺序。

## 用树可视化文件结构

除了`ls`，`ranger`是我最常用的查看文件结构的程序。然而，另一个值得一提的是`tree`，它需要安装在大多数发行版上。`tree`也是非常轻量级的，不用像`ranger`那样打开一个完整的程序来探索文件结构，`tree`可以用来立即创建文件结构的可视化——例如，如果我导航到一个项目并运行以下命令

```sh
tree -L 2

```

Note

这里的两个表示深度显示了多少层(或目录);要深入了解，只需增加数量。

该命令将产生如图 [2-6](#Fig6) 所示的两个文件夹深度的文件结构的可视化。

![../images/494886_1_En_2_Chapter/494886_1_En_2_Fig6_HTML.jpg](../images/494886_1_En_2_Chapter/494886_1_En_2_Fig6_HTML.jpg)

图 2-6

使用树显示文件系统树

## 用 Vim 导航文件系统

我们将有一个专门的章节来用 Vim 进行编辑，但是它也有一个内置的文件/文件夹浏览器。在正常模式下打开 Vim，运行以下命令:

```sh
:Ex

```

这是同样有效的`:Explore`的简称。运行该命令将在 Vim 中打开一个文件浏览器，如图 [2-7](#Fig7) 所示，类似于 Ranger，但没有预览。

![../images/494886_1_En_2_Chapter/494886_1_En_2_Fig7_HTML.jpg](../images/494886_1_En_2_Chapter/494886_1_En_2_Fig7_HTML.jpg)

图 2-7

Vim 探索

您可以选择传递一个想要在 Vim 中使用 explore 打开的文件夹的参数，例如:

```sh
:Ex /home

```

这将导致浏览模式在主文件夹而不是当前工作目录中打开。您将能够使用正常的 Vim 键绑定`j`进行向下导航，使用`k`进行向上导航，或者使用箭头键进行导航。您可以在文件夹或文件上按 enter 键来打开它。

## 摘要

在本章中，我们探讨了与导航文件目录相关的命令。我们还查看了文件属性，如系统链接、隐藏文件和元数据，如上次修改时间。我们看到了 inodes 如何通过将文件名与元数据和磁盘空间中的底层数据相关联，在底层文件系统的工作方式中发挥关键作用。

除了查看文件系统的属性之外，我们还介绍了一些工具，使得探索文件系统变得更加容易。Ranger 和 Vim Explore 都允许我们快速浏览文件。而`ls`上的附加标志选项允许我们看到通常隐藏的文件属性。*