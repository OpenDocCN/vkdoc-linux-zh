# 三、声音编解码器和文件格式

有许多不同的方式来表示声音数据。其中一些涉及压缩数据，这可能会丢失信息，也可能不会丢失信息。数据可以存储在文件系统中，也可以通过网络传输，这带来了其他问题。本章考虑主要的声音编解码器和容器格式。

## 概观

音频和视频数据需要以数字格式表示，以便计算机使用。音频和视频数据包含大量的信息，因此这些数据的数字表示会占用大量的空间。因此，计算机科学家开发了许多不同的方式来表示这些信息，有时以保存所有信息的方式(无损)，有时以丢失信息的方式(有损)。

每种以数字方式表示信息的方式都被称为编解码器。最简单的方法是将其表示为“原始”脉码调制(PCM)数据，这将在下一节介绍。声卡等硬件设备可以直接处理 PCM 数据，但 PCM 数据会占用大量空间。

大多数编解码器会尝试通过将 PCM 数据编码为另一种形式(称为编码数据)来减少 PCM 数据的内存需求。需要时，可以将其解码回 PCM 格式。根据编解码器算法，重新生成的 PCM 可能与原始 PCM 数据具有相同的信息内容(无损)，也可能包含较少的信息(有损)。

编码的音频数据可以包含也可以不包含关于数据属性的信息。该信息可以是关于原始 PCM 数据的，例如声道(单声道、立体声)的数量、采样速率、样本中的位数等等。或者它可以是关于编码过程本身的信息，例如成帧数据的大小。编码数据连同这些附加信息可以存储在文件中，通过网络传输，等等。如果这样做了，编码数据加上附加信息就被合并到一个容器中。

有时，知道您是在处理编码的数据还是在处理保存这些数据的容器是很重要的。例如，磁盘上的文件通常是容器，除了编码数据之外，还保存着其他信息。但是音频数据操作库通常在附加数据被移除之后处理编码数据本身。

## 脉冲编码调制

这个定义来自维基百科:“脉码调制是一种用于数字表示采样模拟信号的方法。它是计算机和各种蓝光、DVD 和 CD 格式的数字音频的标准格式，也是数字电话系统等其他应用的标准格式。PCM 流是模拟信号的数字表示，其中模拟信号的幅度以均匀的间隔有规律地采样，每个样本被量化为数字步长范围内最接近的值。

PCM 流有两个基本属性，决定了它们对原始模拟信号的保真度:采样率，即每秒采样的次数；位深度，决定了每个样本可以采用的可能数字值的数量。

PCM 数据可以作为“原始”数据存储在文件中。在这种情况下，没有头信息来说明采样率和位深度是什么。许多工具如`sox`使用文件扩展名来确定这些属性。

根据 [`http://sox.sourceforge.net/soxformat.html`](http://sox.sourceforge.net/soxformat.html) ，“f32 和 f64 分别表示编码为 32 位和 64 位(IEEE 单精度和双精度)浮点 PCM 的文件；s8、s16、s24 和 s32 分别表示 8、16、24 和 32 位有符号整数 PCMu8、u16、u24 和 u32 分别表示 8、16、24 和 32 位无符号整数 PCM。

但是应该注意，文件扩展名只是帮助理解一些 PCM 编解码器参数以及它们如何存储在文件中。

## 声音资源文件

WAV 是一种将音频数据包装成容器的文件格式。音频数据通常是 PCM。文件格式基于资源交换文件格式(RIFF)。虽然它是微软/IBM 的格式，但似乎不受专利的限制。

Topherlee ( [`www.topherlee.com/software/pcm-tut-wavformat.html`](http://www.topherlee.com/software/pcm-tut-wavformat.html) )对这种格式给出了很好的描述。WAV 文件头包含有关 PCM 编解码器的信息，以及有关其存储方式的信息(例如，little-endian 或 big-endian)。

因为 WAV 文件通常包含未压缩的音频数据，所以它们通常很大，一首三分钟的歌曲大约需要 50Mb。

## MP3 文件

MP3 和相关格式受专利保护(实际上，有很多专利)。要使用编码器或解码器，用户应该向弗劳恩霍夫协会这样的组织支付许可费。大多数临时用户既没有这样做，也没有意识到他们应该这样做，但弗劳恩霍夫( [`www.itif.org/files/2011-fraunhofer-boosting-comp.pdf`](http://www.itif.org/files/2011-fraunhofer-boosting-comp.pdf) )报道称，2011 年 MP3 专利“产生了大约 3 亿美元的年度税收”弗劳恩霍夫协会目前已经选择不追求免费开源实现编码器和解码器的版税。

MP3 使用的编解码器是 MPEG-1 音频层 III ( [`http://en.wikipedia.org/wiki/MP3`](http://en.wikipedia.org/wiki/MP3) )音频压缩格式。这包括一个 header 组件，它给出了关于数据和压缩算法的所有附加信息。不需要单独的容器格式。

## 还有沃比斯

奥格·沃尔比斯是“好人”之一。根据 Vorbis.com 的说法，“Ogg Vorbis 是一种完全开放、无专利、专业的音频编码和流媒体技术，拥有开源的所有优势。”

这些名称细分如下:

*   Ogg: Ogg 是 Xiph.org 的音频、视频和元数据容器格式的名称。这将流数据放入更容易在文件和其他东西中管理的帧中。
*   Vorbis: Vorbis 是 Ogg 中包含的特定音频压缩方案的名称。注意，其他格式也可以嵌入 Ogg 中，比如 FLAC 和 Speex。

扩展名`.oga`是 Ogg 音频文件的首选，尽管以前曾使用过`.ogg`。

有时有必要密切注意 Ogg 和 Vorbis 之间的区别。例如，OpenMAX IL 有许多标准音频组件，包括一个用于解码各种编解码器的组件。具有“音频解码器 ogg”角色的 LIM 组件可以解码 Vorbis 流。但是即使组件包括 ogg 这个名字，它也不能解码 Ogg 文件，Ogg 文件是 Vorbis 流的容器。它只能解码 Vorbis 流。解码 Ogg 文件需要使用不同的组件，称为“带帧的音频解码器”

## WMA 格式

从开源的角度来看，WMA 文件是邪恶的。WMA 文件基于两种微软专有格式。第一种是高级系统格式(ASF)文件格式，它描述了音乐数据的“容器”。第二个是 Windows Media Audio 9 编解码器。

ASF 是首要问题。微软有一个公开的规范( [`www.microsoft.com/en-us/download/details.aspx?id=14995`](http://www.microsoft.com/en-us/download/details.aspx?id=14995) )，强烈反对任何开源的东西。许可证规定，如果您基于该规范构建一个实现，那么您:

*   无法分发源代码
*   只能分发目标代码
*   除非作为“解决方案”的一部分，否则不能分发目标代码(换句话说，库似乎是被禁止的)
*   不能免费分发您的目标代码
*   无法将您的许可证设置为允许衍生作品

而且更重要的是，2012 年 1 月 1 日之后不允许你开始任何新的实施，而且(在撰写本文时)已经是 2017 年了！

只是说的更难听一点，微软有专利 6041345，“用于容纳多个媒体流的活动流格式”( [`www.google.com/patents/US6041345`](http://www.google.com/patents/US6041345) )，1997 年 3 月 7 日在美国申请。该专利似乎覆盖了与当时存在的许多其他格式相同的领域，因此该专利的地位(如果受到质疑)尚不清楚。但是，它已经被用来阻止 GPL 授权的项目 VirtualDub ( [`www.advogato.org/article/101.html`](http://www.advogato.org/article/101.html) )支持 ASF。文件格式的专利状态有点可疑，但现在可能会变得稍微清楚一些，因为 Oracle 已经失去了对 Java API 专利的要求。

尽管如此，FFmpeg 项目( [`http://ffmpeg.org/`](http://ffmpeg.org/) )还是完成了 ASF 的净室实现，对文件格式进行逆向工程，并且根本不使用 ASF 规范。它还逆向工程 WMA 编解码器。这使得像 MPlayer 和 VLC 这样的播放器可以播放 ASF/WMA 文件。FFmpeg 本身也可以从 ASF/WMA 转换成更好的格式，比如 Ogg Vorbis。

没有用于 WMA 文件的 Java 处理程序，考虑到许可，除非是基于 FFmpeg 的本地代码，否则不太可能有。

## -水手

根据 Matroska 的网站( [`http://matroska.org/`](http://matroska.org/) )，Matroska 的目标是成为多媒体容器格式的标准。它源自一个名为 MCF 的项目，但与它有显著的区别，因为它基于可扩展二进制元语言(EBML)，XML 的二进制衍生物。它包含了现代容器格式的一些特性，如下所示:

*   在文件中快速查找
*   章节条目
*   完整的元数据(标签)支持
*   可选字幕/音频/视频流
*   模块化可扩展
*   错误恢复能力(即使在流损坏时也能恢复播放)
*   可通过互联网和本地网络(HTTP、CIFS、FTP 等)流式传输
*   菜单(像 DVD 一样)

直到我开始看字幕， <sup>1</sup> 我才知道 Matroska，它可以(可选地)添加到视频中，似乎是视频的主要格式之一。

在 Ubuntu 资源库中，mkvmerge 是一个 GUI 工具，用于创建和管理 Matroska 文件格式(MKV)的字幕。超级链接" [`https://mkvtoolnix.download/`](https://mkvtoolnix.download/) " MKVToolNix 是一个处理 MKV 文件的 GUI 工具。

## 结论

声音有许多编码解码器，而且更多的正在被设计中。它们可以是编解码器、容器，或者两者兼而有之，它们具有各种各样的特性，有些还带有专利之类的障碍。

Footnotes 1

字幕和隐藏式字幕相似但有区别。根据 [`https://www.accreditedlanguage.com/2016/08/18/subtitles-and-captions-whats-the-difference/`](https://www.accreditedlanguage.com/2016/08/18/subtitles-and-captions-whats-the-difference/) 的说法，“字幕是最常用的一种将媒体翻译成另一种语言的方式，以便说其他语言的人可以欣赏它。另一方面，字幕更常用于帮助失聪和听力受损的观众。”